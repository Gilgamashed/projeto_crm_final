<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>{% block title %}Gestor de projetos{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <style>

        /* styles pro footer */
        html, body {
            height: 100%;
        }

        html {
            scroll-behavior: smooth;
            scroll-padding-top: 4.5rem; /* Previne conteúdo oculto atrás do navbar */
            overscroll-behavior: none;
        }

        body {
            display: flex;
            flex-direction: column;
            background-color: #f8f9fa;
            overflow-x: hidden; /* Previne scroll horizontal */
        }

        .navbar-scrolled {
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .container {
            flex: 1 0 auto;
            max-width: 960px;
            padding-top: 1.5rem;
        }

        footer {
            flex-shrink: 0;
            width: 100%;
        }

        .navbar {
          transition: all 0.3s ease;
        }

        .navbar-brand {
          font-weight: bold;
          font-size: 1.5rem;
          color: #0d6efd !important;
        }

        h2 {
          margin-bottom: 1.5rem;
          font-weight: 600;
        }

        .btn-primary {
          background-color: #0d6efd;
          border-color: #0d6efd;
        }

        .form-label {
          font-weight: 500;
        }

        /* itens desativados do navbar */
        .disabled {
          pointer-events: none;
          opacity: 0.6;
          cursor: not-allowed;
        }

        /* Menssagens de aleerta */
        .alert {
          width: 98%;
          max-width: 1240px;
          padding: 15px 15px 13px 15px;
          margin: 0 auto 35px auto;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          font-size: 0.95rem;
          line-height: 1.5;
        }

        .alert-danger {
          background-color: #f8d7da;
          border-color: #f5c6cb;
          color: #721c24;
        }

        .alert-success {
          background-color: #d4edda;
          border-color: #c3e6cb;
          color: #155724;
        }

        .alert .btn-close {
          padding: 0.75rem;
          position: absolute;
          top: 10px;
          right: 10px;
        }

    </style>

</head>
<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary sticky-top shadow-sm">
      <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'home' %}">Gestor CRM</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
                {% if user.is_authenticated %}
                <a class="nav-link active" aria-current="page" href="{% url 'dashboard' %}">Dashboard</a>
                {% else %}
                <a class="nav-link active" aria-current="page" href="{% url 'home' %}">Home</a>
                {% endif %}
            </li>
                            <!-- navbar Projetos -->
            {% if user.is_authenticated %}
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                Projetos
              </a>
              <ul class="dropdown-menu">
                {% if active_projeto %}
                  <li><a class="dropdown-item" href="{% url 'projetos_detail' active_projeto.id %}">Meu Projeto</a></li>
                {% else %}
                  <li><span class="dropdown-item disabled text-muted">Meu projeto</span></li>
                {% endif %}
                <li><a class="dropdown-item" href="{% url 'projetos_list' %}">Projetos</a></li>
              </ul>
            </li>
            {% endif %}
                            <!-- navbar equipes -->
            {% if user.is_authenticated %}
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                Equipes
              </a>
              <ul class="dropdown-menu">
                {% if has_team %}
                  <li><a class="dropdown-item" href="{% url 'equipes_detail' active_equipe.id %}">Minha Equipe</a></li>
                {% else %}
                  <li><span class="dropdown-item disabled text-muted">Minha Equipe</span></li>
                {% endif %}
                <li><a class="dropdown-item" href="{% url 'equipes_list' %}">Equipes</a></li>
              </ul>
            </li>
            {% endif %}

              <!-- navbar ADMIN only -->
            {% if user.is_authenticated and is_admin %}
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                Ferramentas Admin
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{% url 'admin_integ_list' %}">Lista de Integrantes</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
              </ul>
            </li>
            {% endif %}

              <!-- navbar Perfil user -->
            {% if user.is_authenticated %}
            <li class="nav-item">
              {% if current_user_profile %}
                <a class="nav-link active" aria-current="page"
                   href="{% url 'account_user_detail' person_id=current_user_profile.person_id %}">
                  Perfil
                </a>
              {% else %}
                <span class="nav-link disabled text-muted">Perfil</span>
              {% endif %}
            </li>
            {% endif %}
          </ul>

          {% if user.is_authenticated %}
            <form action="{% url 'account_logout' %}" class="d-flex" method="post" role="search">
                {% csrf_token %}
                <button class="btn btn-outline-danger" type="submit">Sair</button>
            </form>
          {% else %}
            <a class="btn btn-outline-primary" href="{% url 'account_login' %}">Entrar</a>
          {% endif %}
        </div>
      </div>
    </nav>

            <!-- Menssagens -->
    {% if messages %}
      <div class="message-container">
        {% for message in messages %}
          <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
            <div class="d-flex align-items-center justify-content-center">
              <i class="bi {% if 'error' in message.tags %}bi-exclamation-triangle-fill{% else %}bi-check-circle-fill{% endif %} me-2"></i>
              <div>
                <strong class="me-2">{% if 'error' in message.tags %}Erro:{% else %}Sucesso:{% endif %}</strong>
                {{ message }}
              </div>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="container mt-4">
        {% block content %}{% endblock %}
    </div>

        <!-- footer -->
    <footer class="mt-5 py-4 bg-light border-top">
        <div class="container">
            <div class="text-center">
                <p class="text-muted mb-1">Precisa de ajuda? Envie um e-mail para <a href="mailto:projeto.minstrel@gmail.com">projeto.minstrel@gmail.com</a></p>
                <p class="text-muted">Versão 1.0 - © {% now "Y" %} Caius I O</p>
            </div>
        </div>
    </footer>

    <!-- carrega o bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>


    <script>
        // Otimização do scroll para sombra
        let lastScrollTop = 0;
        const navbar = document.querySelector('.navbar');

        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            // Atualiza sombra apenas quando necessário
            if (scrollTop > 10) {
                navbar.classList.add('navbar-scrolled');
            } else {
                navbar.classList.remove('navbar-scrolled');
            }

            // Suaviza transições
            if (Math.abs(scrollTop - lastScrollTop) > 50) {
                lastScrollTop = scrollTop;
            }
        });

        // Suaviza links âncora
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    window.scrollTo({
                        top: target.offsetTop - 70, // Ajusta para navbar
                        behavior: 'smooth'
                    });
                }
            });
        });
    </script>
</body>
</html>