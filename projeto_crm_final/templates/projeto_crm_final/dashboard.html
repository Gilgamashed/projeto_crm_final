{% extends 'projeto_crm_final/base.html' %}
{% load widget_tweaks %}
{% block title %}Bem Vindo!{% endblock %}


{% block content %}
<div class="header">
  <h1>Bem vindo(a), {{ integrante.nome }} {{ integrante.sobrenome }}</h1>

  {% if no_profile %}
    <div class="alert alert-danger">
      Perfil não encontrado. Notifique um administrador.
    </div>
  {% elif no_team %}
    <div class="alert alert-info">
      Não pertence a nenhuma equipe! <a href="{% url 'equipes_list' %}">Encontre ou Crie uma!</a>
    </div>
  {% else %}
    <div class="team-info">
      <h2>Sua Equipe: {{ equipe.nome }}</h2>

      {% if active_projeto %}
        <h3>Projeto Ativo: {{ active_projeto.nome }}</h3>
      {% else %}
        <div class="alert alert-warning">
          Sua equipe não tem projetos ativos!
        </div>
      {% endif %}
    </div>
  {% endif %}
</div>

{% if active_projeto %}
<div class="kanban-board">
  <!-- TO DO Coluna -->
  <div class="column">
    <h3>Pra Fazer</h3>
    {% for task in todo_tasks %}
      <div class="task-card">
        <h4>{{ task.name }}</h4>
        <p>{{ task.prioridade }}</p>
        <form method="post" action="{% url 'tarefas_assign' task.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">Trabalhar!</button>
        </form>
        <div class="btn-group">
          <!-- botao Detalhes -->
          <a href="{% url 'tarefas_detail' task.id %}"
             class="btn btn-sm btn-outline-info">
              <i class="bi bi-eye"></i>
          </a>

        </div>
      </div>
    {% endfor %}
  </div>

  <!-- DOING Column -->
  <div class="column">
    <h3>Fazendo</h3>
    {% for task in doing_tasks %}
      <div class="task-card">
        <h4>{{ task.name }}</h4>
        <p>{{ task.prioridade }}</p>
        <p><strong>Responsável:</strong>{{ task.responsavel.nome }} ({{ task.responsavel.cargo }})</p>
        <div class="btn-group">
          <!-- botao Detalhes -->
          <a href="{% url 'tarefas_detail' task.id %}"
             class="btn btn-sm btn-outline-info">
              <i class="bi bi-eye"></i>
          </a>
                  <!-- Botao report -->
          <a href="{% url 'tarefas_report' task.id %}"
             class="btn btn-sm btn-success ms-1">
            <i class="bi bi-check-circle"></i> Concluir!
          </a>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- DONE Column -->
  <div class="column">
    <h3>Feito</h3>
    {% for task in done_tasks %}
      <div class="task-card">
        <h4>{{ task.name }}</h4>
        <p>{{ task.status }}</p>
        <p><strong>Concluído por:</strong>{{ task.responsavel.nome }} ({{ task.responsavel.cargo }})</p>
        <div class="btn-group">
          <!-- botao Detalhes -->
          <a href="{% url 'tarefas_detail' task.id %}"
             class="btn btn-sm btn-outline-info">
              <i class="bi bi-eye"></i>
          </a>

        </div>
      {% endfor %}
      </div>
  </div>
{% else %}
  {% if equipe %}
    <div class="alert alert-warning">
      Sua equipe não tem projetos ativos!
    </div>
  {% endif %}
{% endif %}

<style>
  .kanban-board {
    display: flex;
    gap: 20px;
    margin-top: 30px;
  }
  .column {
    flex: 1;
    background: #f5f5f5;
    padding: 15px;
    border-radius: 8px;
  }
  .task-card {
    background: white;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
</style>
{% endblock %}
